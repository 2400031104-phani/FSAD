<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Apparel Donation ‚Äî DonateHub</title>
    <link rel="stylesheet" href="css/styles.css" />
    <style>
        [x-cloak] { display: none !important; }

        .module-card { max-width: 560px; margin: 0 auto; }

        /* Age-group selector grid */
        .age-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: var(--sp-3);
            margin-top: var(--sp-3);
        }

        .age-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: var(--sp-1);
            padding: var(--sp-4) var(--sp-2);
            border-radius: var(--radius-md);
            border: 1.5px solid var(--clr-border);
            background: var(--clr-surface);
            color: var(--clr-text-2);
            font-size: var(--fs-lg);
            font-weight: 700;
            font-family: var(--font-heading);
            transition: all var(--t-base);
            cursor: pointer;
        }

        .age-btn small {
            font-size: var(--fs-xs);
            font-weight: 500;
            font-family: var(--font-body);
            color: var(--clr-text-3);
        }

        .age-btn:hover {
            border-color: var(--clr-primary);
            background: rgba(108,99,255,0.12);
            color: var(--clr-text);
            transform: translateY(-2px);
        }

        .age-btn.selected {
            border-color: var(--clr-primary);
            background: rgba(108,99,255,0.22);
            color: var(--clr-primary-l);
            box-shadow: 0 0 0 2px rgba(108,99,255,0.35);
        }

        /* Native select */
        .select-wrap { position: relative; }

        .select-wrap::after {
            content: '‚ñæ';
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--clr-text-3);
        }

        .form-select {
            width: 100%;
            padding: 0.75rem 2.5rem 0.75rem 1rem;
            border-radius: var(--radius-md);
            border: 1.5px solid var(--clr-border);
            background: var(--clr-surface);
            color: var(--clr-text);
            font-size: var(--fs-base);
            appearance: none;
            -webkit-appearance: none;
            transition: border-color var(--t-fast), box-shadow var(--t-fast);
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--clr-primary);
            box-shadow: 0 0 0 3px rgba(108,99,255,0.25);
        }

        .form-select option { background: #1a1f3a; }

        .record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--sp-3) var(--sp-4);
            border-radius: var(--radius-md);
            background: var(--clr-surface);
            border: 1px solid var(--clr-border);
            font-size: var(--fs-sm);
        }

        .record-item + .record-item { margin-top: var(--sp-2); }

        .rec-chip {
            display: inline-flex;
            align-items: center;
            gap: var(--sp-1);
            background: rgba(0,212,170,0.15);
            color: var(--clr-accent-2);
            border-radius: var(--radius-full);
            padding: 2px var(--sp-3);
            font-size: var(--fs-xs);
            font-weight: 600;
        }

        .tab-row { display: flex; gap: var(--sp-3); margin-bottom: var(--sp-6); }

        .tab-btn {
            padding: var(--sp-2) var(--sp-5);
            border-radius: var(--radius-full);
            border: 1.5px solid var(--clr-border);
            background: transparent;
            color: var(--clr-text-3);
            font-size: var(--fs-sm);
            font-weight: 600;
            transition: all var(--t-fast);
        }

        .tab-btn.active {
            background: rgba(108,99,255,0.18);
            border-color: var(--clr-primary);
            color: var(--clr-primary-l);
        }
    </style>
</head>

<!-- x-data on <body> activates Alpine for all $store references on this page -->
<body class="page-wrapper" x-data>
    <div class="bg-orb bg-orb-1"></div>
    <div class="bg-orb bg-orb-2"></div>

    <!-- Header -->
    <header class="app-header">
        <div class="container">
            <div class="header-inner">
                <a href="dashboard.html" class="header-brand">
                    <div class="brand-icon">üíù</div>
                    <span class="text-gradient">DonateHub</span>
                </a>
                <nav class="header-nav">
                    <div style="position:relative;">
                        <button class="profile-btn" id="profileBtn" aria-expanded="false"></button>
                        <div class="profile-dropdown" id="profileDropdown">
                            <div class="dropdown-header">
                                <div class="dropdown-user-name"></div>
                                <div class="dropdown-user-email"></div>
                            </div>
                            <a href="dashboard.html" class="dropdown-item">üè† Dashboard</a>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item danger" id="logoutBtn">üö™ Sign Out</button>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <main style="flex:1; padding-bottom:4rem;">
        <div class="container">

            <!-- Hero -->
            <div class="page-hero fade-in-up">
                <a href="dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>
                <h1 class="page-hero-title">üëï Apparel <span class="text-gradient">Donation</span></h1>
                <p class="page-hero-sub">Select the age group for the clothing items you are donating.</p>
            </div>

            <!-- Form Card -->
            <div class="glass-card module-card fade-in-up" style="padding:2rem;">

                <h2 style="font-size:1.125rem; font-weight:700; margin-bottom:1.5rem;">
                    <span style="background:var(--grad-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">
                        Select Age Group
                    </span>
                </h2>

                <!-- View toggle -->
                <div class="tab-row">
                    <button
                        class="tab-btn"
                        :class="{ active: $store.apparelForm.viewMode === 'grid' }"
                        @click="$store.apparelForm.viewMode = 'grid'"
                    >Grid</button>
                    <button
                        class="tab-btn"
                        :class="{ active: $store.apparelForm.viewMode === 'dropdown' }"
                        @click="$store.apparelForm.viewMode = 'dropdown'"
                    >Dropdown</button>
                </div>

                <!-- Grid view (x-for populates from store array) -->
                <div x-show="$store.apparelForm.viewMode === 'grid'">
                    <div class="age-grid">
                        <template x-for="age in $store.apparelForm.AGE_GROUPS" :key="age">
                            <button
                                class="age-btn"
                                :class="{ selected: $store.apparelForm.selectedAge === age }"
                                @click="$store.apparelForm.selectAge(age)"
                                :title="$store.apparelForm.AGE_LABELS[age]"
                            >
                                <span x-text="age"></span>
                                <small x-text="($store.apparelForm.AGE_LABELS[age] || '').split('(')[1]?.replace(')', '') || ''"></small>
                            </button>
                        </template>
                    </div>
                </div>

                <!-- Dropdown view (x-model.number keeps value as integer) -->
                <div x-show="$store.apparelForm.viewMode === 'dropdown'" x-cloak>
                    <label
                        style="font-size:var(--fs-sm); font-weight:600; color:var(--clr-text-2); letter-spacing:0.04em; text-transform:uppercase; display:block; margin-bottom:var(--sp-3);"
                        for="ageSelect">Age Group
                    </label>
                    <div class="select-wrap">
                        <select class="form-select" id="ageSelect"
                                x-model.number="$store.apparelForm.selectedAge">
                            <option :value="null">‚Äî Choose an age group ‚Äî</option>
                            <template x-for="age in $store.apparelForm.AGE_GROUPS" :key="age">
                                <option :value="age"
                                        x-text="`${age} ‚Äî ${$store.apparelForm.AGE_LABELS[age]}`">
                                </option>
                            </template>
                        </select>
                    </div>
                </div>

                <!-- Selection badge ‚Äî shown only when something is selected -->
                <div x-show="$store.apparelForm.selectedAge !== null"
                     x-cloak
                     style="margin-top:var(--sp-5);">
                    <div style="display:flex; align-items:center; gap:var(--sp-3); padding:var(--sp-4); border-radius:var(--radius-md); background:rgba(0,212,170,0.1); border:1px solid rgba(0,212,170,0.25);">
                        <span style="font-size:1.5rem;">üëï</span>
                        <div>
                            <div style="font-size:var(--fs-sm); color:var(--clr-text-3);">Selected Age Group</div>
                            <div style="font-size:var(--fs-xl); font-weight:800; color:var(--clr-accent-2);"
                                 x-text="$store.apparelForm.selectedLabel">
                            </div>
                        </div>
                    </div>
                </div>

                <button
                    class="btn btn-primary"
                    style="width:100%; margin-top:var(--sp-6);"
                    @click="$store.apparelForm.submit()"
                    :disabled="$store.apparelForm.isLoading"
                >
                    <div class="btn-spinner" x-show="$store.apparelForm.isLoading"></div>
                    <span class="btn-label"
                          x-text="$store.apparelForm.isLoading ? 'Saving‚Ä¶' : 'Log Donation üëï'">
                    </span>
                </button>
            </div>

            <!-- Recent Records -->
            <div class="module-card fade-in-up"
                 x-show="$store.apparelForm.records.length > 0"
                 x-cloak
                 style="margin-top:var(--sp-8);">
                <h3 style="font-size:1rem; font-weight:700; margin-bottom:var(--sp-4); color:var(--clr-text-2);">
                    Recent Apparel Donations
                </h3>
                <template x-for="r in $store.apparelForm.records" :key="r.id">
                    <div class="record-item">
                        <div>
                            <div style="font-weight:600; margin-bottom:2px;">Apparel Donation</div>
                            <div style="font-size:var(--fs-xs); color:var(--clr-text-3);"
                                 x-text="$store.apparelForm.formatDate(r.createdAt)"></div>
                        </div>
                        <span class="rec-chip"
                              x-text="`üëï Age ${r.target_age} ‚Äî ${$store.apparelForm.AGE_LABELS[r.target_age] || ''}`">
                        </span>
                    </div>
                </template>
            </div>

        </div>
    </main>

    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/service.js"></script>
    <script src="js/alpine-store.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"></script>

    <!-- Thin auth block: runs synchronously, before Alpine boots -->
    <script>
        window._dmsSession = requireAuth();
        if (!window._dmsSession) throw new Error('Unauthenticated');
        renderHeaderProfile(window._dmsSession);

        /* Global success listener: redirects to Confirmation View */
        window.addEventListener('donationSuccess', function (e) {
            redirectTo('confirmation.html?rid=' + e.detail.id, 250);
        });
    </script>
</body>

</html>
